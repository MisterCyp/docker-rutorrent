os: linux
language: shell

services:
  - docker

jobs:
  include:
  - name: build tag latest
    arch: amd64
    env: TAG=latest
    script: docker build --pull --tag mondedie/rutorrent:${TAG} .
  - name: build tag latest
    arch: arm64
    env: TAG=latest
    script: docker build --pull --tag mondedie/rutorrent:${TAG} .
  - name: build tag filebot
    arch: amd64
    env: TAG=filebot
    script: docker build --build-arg FILEBOT=true --pull --tag mondedie/rutorrent:${TAG} .
  - name: build tag filebot
    arch: arm64
    env: TAG=filebot
    script: docker build --build-arg FILEBOT=true --pull --tag mondedie/rutorrent:${TAG} .

before_deploy:
  - docker login -u ${DOCKER_USERNAME} -p ${DOCKER_PASSWORD}

deploy:
  provider: script
  script: docker push mondedie/rutorrent:${TAG}
